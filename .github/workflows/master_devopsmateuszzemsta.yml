name: Deploy ASP.Net Core app to Azure Web App

# üîπ Uruchomienie tylko po udanym CI workflow
on:
  workflow_run:
    workflows: ["CI"]      # nazwa Twojego CI workflow
    types:
      - completed

jobs:
  deploy:
    runs-on: windows-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}  # tylko je≈õli CI zako≈Ñczy≈Ço siƒô sukcesem
    permissions:
      id-token: write       # do JWT dla Azure
      contents: read        # potrzebne do pobrania artefaktu

    steps:
      # 1Ô∏è‚É£ Pobranie artefaktu builda z CI
      - name: Download artifact from CI
        uses: actions/download-artifact@v4
        with:
          name: .net-app      # dok≈Çadnie tak jak nazwa artefaktu w CI
          path: ./publish     # lokalny folder, gdzie bƒôdzie zapisany

      # 2Ô∏è‚É£ Logowanie do Azure
      - name: Login to Azure
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.AZUREAPPSERVICE_CLIENTID_99E47F5208134825B2F9CB3450E0B5F3 }}
          tenant-id: ${{ secrets.AZUREAPPSERVICE_TENANTID_0EDA28F9D75F42AF8BD8299AAB5836D2 }}
          subscription-id: ${{ secrets.AZUREAPPSERVICE_SUBSCRIPTIONID_F91D6B37B88B447D87B3ECB83D7C4911 }}

      # 3Ô∏è‚É£ Deploy do Azure Web App
      - name: Deploy to Azure Web App
        uses: azure/webapps-deploy@v3
        with:
          app-name: 'devopsmateuszzemsta'   # nazwa Twojej Web App w Azure
          slot-name: 'Production'           # slot produkcyjny
          package: ./publish                # folder z artefaktem z CI
