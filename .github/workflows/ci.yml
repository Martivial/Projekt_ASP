name: CI

# ğŸ”¹ Kiedy uruchamiamy workflow
on:
  push:
    branches: [ master ]       # uruchamia siÄ™ przy pushu do master
  pull_request:
    branches: [ master ]       # uruchamia siÄ™ przy PR do master

jobs:
  build-and-test:
    runs-on: ubuntu-latest       # system, na ktÃ³rym bÄ™dzie dziaÅ‚aÅ‚ pipeline

    steps:
      # 1ï¸âƒ£ Pobranie kodu z repozytorium
      - uses: actions/checkout@v3
        name: Checkout repository
        # Pobiera wszystkie pliki repozytorium na maszynÄ™ CI

      # 2ï¸âƒ£ Instalacja .NET 8
      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '8.0.x'
        # Potrzebne do kompilacji i uruchomienia testÃ³w

      # 3ï¸âƒ£ PrzywrÃ³cenie paczek NuGet
      - name: Restore dependencies
        run: dotnet restore
        # Pobiera wszystkie potrzebne paczki (Entity Framework, itp.)

      # 4ï¸âƒ£ Kompilacja projektu
      - name: Build
        run: dotnet build --configuration Debug --no-restore
        # Sprawdza, czy projekt w ogÃ³le siÄ™ buduje
        # âŒ JeÅ›li build FAIL, workflow zatrzymuje siÄ™ â€” to jest pierwszy poziom Quality Gate

      # 5ï¸âƒ£ Uruchomienie testÃ³w i wygenerowanie raportu
      - name: Run Tests
        run: |
          mkdir -p Tests/TestResults
          dotnet test ./Tests/Tests.csproj \
            --configuration Debug \
            --logger "trx;LogFileName=Tests/TestResults/test-results.trx"
        # To jest wÅ‚aÅ›ciwy Quality Gate:
        # âŒ JeÅ›li jakikolwiek test FAIL, workflow zatrzymuje siÄ™
        # âœ… JeÅ›li wszystkie testy PASS, pipeline przechodzi dalej
        # Plik .trx to raport z testÃ³w

      # 6ï¸âƒ£ Upload raportu testÃ³w jako artefakt
      - name: Upload Test Results
        uses: actions/upload-artifact@v4
        with:
          name: test-results
          path: ./Tests/TestResults
        # DziÄ™ki temu raport jest dostÄ™pny w GitHub Actions â†’ Artifacts
        # MoÅ¼esz go pobraÄ‡ i przejrzeÄ‡ w Visual Studio lub innych narzÄ™dziach
